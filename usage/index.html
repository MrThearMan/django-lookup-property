<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Usage - Django Lookup Property</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link href="../css/docs.css" rel="stylesheet" />
        <link href="../css/pygments.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Usage";
        var mkdocs_page_input_path = "usage.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]--> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Django Lookup Property
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../intro/">Introduction</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Usage</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#filtering">Filtering</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#annotating">Annotating</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#related-lookups">Related lookups</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#subqueries">Subqueries</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#additional-lookups">Additional lookups</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../converters/">Converters</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Django Lookup Property</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Usage</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="usage">Usage<a class="headerlink" href="#usage" title="Permanent link">ðŸ”—</a></h1>
<h2 id="filtering">Filtering<a class="headerlink" href="#filtering" title="Permanent link">ðŸ”—</a></h2>
<p>You can use the lookup property in queries by referring to it inside a special <code>L</code> expression:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-1">1</a></span>
<span class="normal"><a href="#__codelineno-0-2">2</a></span>
<span class="normal"><a href="#__codelineno-0-3">3</a></span>
<span class="normal"><a href="#__codelineno-0-4">4</a></span>
<span class="normal"><a href="#__codelineno-0-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Student</span>
<a id="__codelineno-0-2" name="__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">lookup_property</span><span class="w"> </span><span class="kn">import</span> <span class="n">L</span>
<a id="__codelineno-0-3" name="__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-0-4" name="__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">create</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="s2">&quot;John&quot;</span><span class="p">,</span> <span class="n">last_name</span><span class="o">=</span><span class="s2">&quot;Doe&quot;</span><span class="p">)</span>
<a id="__codelineno-0-5" name="__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">Student</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">full_name</span><span class="o">=</span><span class="s2">&quot;John Doe&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
<p>The <code>L</code> expression will find the lookup property on the model, and replace it with the
expression defined by it. This allows you to use the property in queries as
if it was a normal field.</p>
<p>You can also use the lookup property as the filter value:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-1-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-1-1" name="__codelineno-1-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="s2">&quot;full_name&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<p>For more complex filters, <code>L</code> expressions can also be used inside <code>Q</code> expressions:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-2-1">1</a></span>
<span class="normal"><a href="#__codelineno-2-2">2</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-2-1" name="__codelineno-2-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Q</span>
<a id="__codelineno-2-2" name="__codelineno-2-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">Q</span><span class="p">(</span><span class="n">first_name</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="s2">&quot;full_name&quot;</span><span class="p">))</span> <span class="o">|</span> <span class="n">Q</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">full_name</span><span class="o">=</span><span class="s2">&quot;John Doe&quot;</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
<h2 id="annotating">Annotating<a class="headerlink" href="#annotating" title="Permanent link">ðŸ”—</a></h2>
<p>You can also annotate the lookup property to pre-calculate it in the QuerySet.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-3-1">1</a></span>
<span class="normal"><a href="#__codelineno-3-2">2</a></span>
<span class="normal"><a href="#__codelineno-3-3">3</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-3-1" name="__codelineno-3-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">Student</span> <span class="o">=</span> <span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="n">full_name</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="s2">&quot;full_name&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<a id="__codelineno-3-2" name="__codelineno-3-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">Student</span><span class="o">.</span><span class="n">full_name</span>
<a id="__codelineno-3-3" name="__codelineno-3-3"></a><span class="go">&#39;John Doe&#39;</span>
</code></pre></div></td></tr></table></div>
<p>This bypasses the python code/override, which can be more efficient when fetching
multiple rows at once (especially if the property contains complex expressions or joins).</p>
<blockquote>
<p>See the <code>concrete</code> argument on <code>lookup_property</code> decorator if you always want this behavior.</p>
</blockquote>
<h2 id="related-lookups">Related lookups<a class="headerlink" href="#related-lookups" title="Permanent link">ðŸ”—</a></h2>
<p>The <code>L</code> expression also allows you to use the lookup property in related lookups:</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-4-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-4-1" name="__codelineno-4-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">Class</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">students__full_name</span><span class="o">=</span><span class="s2">&quot;John Doe&quot;</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
<p>This will find the appropriate model where the lookup property is defined and
add the necessary joins to the query automatically.</p>
<h2 id="subqueries">Subqueries<a class="headerlink" href="#subqueries" title="Permanent link">ðŸ”—</a></h2>
<p>If the lookup property is used in a subquery in an OuterRef, note that the
<code>L</code> expression should wrap the whole subquery, and not just the OuterRef, since the
lookup property is located in the outer query model and not the subquery model.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-5-1">1</a></span>
<span class="normal"><a href="#__codelineno-5-2">2</a></span>
<span class="normal"><a href="#__codelineno-5-3">3</a></span>
<span class="normal"><a href="#__codelineno-5-4">4</a></span>
<span class="normal"><a href="#__codelineno-5-5">5</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-5-1" name="__codelineno-5-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">django.db.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">OuterRef</span><span class="p">,</span> <span class="n">Subquery</span>
<a id="__codelineno-5-2" name="__codelineno-5-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span><span class="w"> </span><span class="nn">myapp.models</span><span class="w"> </span><span class="kn">import</span> <span class="n">Class</span><span class="p">,</span> <span class="n">Person</span>
<a id="__codelineno-5-3" name="__codelineno-5-3"></a><span class="gp">&gt;&gt;&gt;</span>
<a id="__codelineno-5-4" name="__codelineno-5-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">sq</span> <span class="o">=</span> <span class="n">Class</span><span class="o">.</span><span class="n">objecs</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">teacher_name</span><span class="o">=</span><span class="n">OuterRef</span><span class="p">(</span><span class="s2">&quot;full_name&quot;</span><span class="p">))</span><span class="o">.</span><span class="n">values</span><span class="p">(</span><span class="s2">&quot;pk&quot;</span><span class="p">)</span>
<a id="__codelineno-5-5" name="__codelineno-5-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">Person</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">id__in</span><span class="o">=</span><span class="n">L</span><span class="p">(</span><span class="n">models</span><span class="o">.</span><span class="n">Subquery</span><span class="p">(</span><span class="n">sq</span><span class="p">)))</span>
</code></pre></div></td></tr></table></div>
<h2 id="additional-lookups">Additional lookups<a class="headerlink" href="#additional-lookups" title="Permanent link">ðŸ”—</a></h2>
<p>Lookup property can be used with additional lookups, such as <code>__in</code>, <code>__lt</code>, <code>__gt</code>, etc.</p>
<div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-6-1">1</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-6-1" name="__codelineno-6-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">Student</span><span class="o">.</span><span class="n">objects</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">L</span><span class="p">(</span><span class="n">full_name__in</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;John Doe&quot;</span><span class="p">,</span> <span class="s2">&quot;Jane Doe&quot;</span><span class="p">]))</span>
</code></pre></div></td></tr></table></div>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../intro/" class="btn btn-neutral float-left" title="Introduction"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../converters/" class="btn btn-neutral float-right" title="Converters">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../intro/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../converters/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
